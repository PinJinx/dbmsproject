/login
/register


faculty:
- grade exams
- search through studenst
- create exams

admin:
- assign faculty
- create departments

students:
- enroll for exams
- take an exam
- enroll course
- view results




#TODO
add name to user
ALTER TABLE departments ALTER COLUMN dept_id ADD GENERATED BY DEFAULT AS IDENTITY;



























these are the basic functionality i want:
/login
/register


faculty:
- grade exams
- search through studenst
- create exams

admin:
- assign faculty
- create departments

students:
- enroll for exams
- take an exam
- enroll course
- view results


This is the current backend:
from flask import Flask, jsonify,request
import psycopg
from schemas import RegisterUser,LoginUser
app = Flask(__name__)

conn = psycopg.connect(
    dbname="dbmsproject",
    user="postgres",
    password="kovoor@73",
    host="localhost",
    port="5432"
)

@app.route('/')
def index():
    return jsonify({'Test':'Hello'})



@app.route('/register', methods=['POST'])
def register_user():
    try:
        cursor = conn.cursor()
        user = RegisterUser(**request.get_json())
        cursor.execute('''
        INSERT INTO users (name, email, password, role,dob,address)
        VALUES (%s, %s, %s, %s,%s,%s);''',(user.name,user.email,user.password,user.role,user.dob,user.address))
        conn.commit()
        cursor.close()
        return jsonify({"Sucess":"Database Updated"}),200
        
    except Exception as e:
        return jsonify({"Error":str(e)}),201


@app.route('/create/exams', methods=['POST'])
def create_department():
    try:
        cursor = conn.cursor()
        user = LoginUser(**request.get_json())
        cursor.execute('''
        select * from users where email=%s and password=%s 
        ''',(user.email,user.password))
        
        response = cursor.fetchone()
        if(response == None):
            return jsonify({"Error":"User_Not_Found"}),400
        else:
            cursor.close()
            return jsonify({"data":response}),200
    except Exception as e:
        return jsonify({"Error":str(e)}),201




@app.route('/login', methods=['POST'])
def login_user():
    try:
        cursor = conn.cursor()
        user = LoginUser(**request.get_json())
        cursor.execute('''
        select * from users where email=%s and password=%s 
        ''',(user.email,user.password))
        
        response = cursor.fetchone()
        if(response == None):
            return jsonify({"Error":"User_Not_Found"}),400
        else:
            cursor.close()
            return jsonify({"data":response}),200
    except Exception as e:
        return jsonify({"Error":str(e)}),201



@app.route('/course/add', methods=['POST'])
def add_course():
    try:
        cursor = conn.cursor()
        user = LoginUser(**request.get_json())
        cursor.execute('''
        select * from users where email=%s and password_hash=%s 
        ''',(user.email,user.password))
        
        response = cursor.fetchone()
        if(response == None):
            return jsonify({"Error":"User_Not_Found"}),400
        else:
            cursor.close()
            return jsonify({"data":response}),200
    except Exception as e:
        return jsonify({"Error":str(e)}),201



if __name__ == '__main__':
    app.run(debug=True)




from pydantic import BaseModel
from typing import Literal

class RegisterUser(BaseModel):
    name:str
    email:str
    password:str
    role:Literal["teacher","faculty","admin"]
    dob:str
    address:str


class LoginUser(BaseModel):
    email:str
    password:str



class CreateDepartment:
    deptid:str
    deptname:str
    deptcode:str


this is the current db:
 Schema |      Name       | Type  |  Owner   
--------+-----------------+-------+----------
 public | courses         | table | postgres
 public | departments     | table | postgres
 public | exam_results    | table | postgres
 public | exams           | table | postgres
 public | faculty         | table | postgres
 public | student_courses | table | postgres
 public | students        | table | postgres
 public | users           | table | postgres

                        Table "public.courses"
   Column    |          Type          | Collation | Nullable | Default 
-------------+------------------------+-----------+----------+---------
 course_id   | bigint                 |           | not null | 
 dept_id     | bigint                 |           | not null | 
 faculty_id  | bigint                 |           |          | 
 course_name | character varying(200) |           | not null | 
 semester    | smallint               |           |          | 
Indexes:
    "courses_pkey" PRIMARY KEY, btree (course_id)
Check constraints:
    "courses_semester_check" CHECK (semester >= 1 AND semester <= 12)
Foreign-key constraints:
    "courses_dept_id_fkey" FOREIGN KEY (dept_id) REFERENCES departments(dept_id)
    "courses_faculty_id_fkey" FOREIGN KEY (faculty_id) REFERENCES faculty(faculty_id)
Referenced by:
    TABLE "exams" CONSTRAINT "exams_course_id_fkey" FOREIGN KEY (course_id) REFERENCES courses(course_id) ON DELETE CASCADE
    TABLE "student_courses" CONSTRAINT "student_courses_course_id_fkey" FOREIGN KEY (course_id) REFERENCES courses(course_id) ON DELETE CASCADE

                    Table "public.departments"
  Column   |          Type          | Collation | Nullable | Default 
-----------+------------------------+-----------+----------+---------
 dept_id   | bigint                 |           | not null | 
 dept_name | character varying(100) |           | not null | 
 dept_code | character varying(20)  |           | not null | 
Indexes:
    "departments_pkey" PRIMARY KEY, btree (dept_id)
    "departments_dept_code_key" UNIQUE CONSTRAINT, btree (dept_code)
Referenced by:
    TABLE "courses" CONSTRAINT "courses_dept_id_fkey" FOREIGN KEY (dept_id) REFERENCES departments(dept_id)
    TABLE "faculty" CONSTRAINT "faculty_dept_id_fkey" FOREIGN KEY (dept_id) REFERENCES departments(dept_id)

               Table "public.exam_results"
     Column     |         Type         | Collation | Nullable | Default 
----------------+----------------------+-----------+----------+---------
 exam_id        | bigint               |           | not null | 
 student_id     | bigint               |           | not null | 
 marks_obtained | smallint             |           | not null | 
 grade          | character varying(2) |           |          | 
Indexes:
    "exam_results_pkey" PRIMARY KEY, btree (exam_id, student_id)
Check constraints:
    "exam_results_marks_obtained_check" CHECK (marks_obtained >= 0)
Foreign-key constraints:
    "exam_results_exam_id_fkey" FOREIGN KEY (exam_id) REFERENCES exams(exam_id) ON DELETE CASCADE
    "exam_results_student_id_fkey" FOREIGN KEY (student_id) REFERENCES students(user_id) ON DELETE CASCADE
            Table "public.exams"
   Column    |          Type          | Collation | Nullable | Default 
-------------+------------------------+-----------+----------+---------
 exam_id     | bigint                 |           | not null | 
 course_id   | bigint                 |           | not null | 
 exam_date   | date                   |           | not null | 
 total_marks | smallint               |           | not null | 
 exam_name   | character varying(200) |           | not null | 
Indexes:
    "exams_pkey" PRIMARY KEY, btree (exam_id)
Check constraints:
    "exams_total_marks_check" CHECK (total_marks > 0)
Foreign-key constraints:
    "exams_course_id_fkey" FOREIGN KEY (course_id) REFERENCES courses(course_id) ON DELETE CASCADE
Referenced by:
    TABLE "exam_results" CONSTRAINT "exam_results_exam_id_fkey" FOREIGN KEY (exam_id) REFERENCES exams(exam_id) ON DELETE CASCADE
                 Table "public.faculty"
   Column   |     Type      | Collation | Nullable | Default 
------------+---------------+-----------+----------+---------
 faculty_id | bigint        |           | not null | 
 user_id    | bigint        |           | not null | 
 dept_id    | bigint        |           | not null | 
 salary     | numeric(10,2) |           |          | 
Indexes:
    "faculty_pkey" PRIMARY KEY, btree (faculty_id)
    "faculty_user_id_key" UNIQUE CONSTRAINT, btree (user_id)
Check constraints:
    "faculty_salary_check" CHECK (salary >= 0::numeric)
Foreign-key constraints:
    "faculty_dept_id_fkey" FOREIGN KEY (dept_id) REFERENCES departments(dept_id)
    "faculty_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE
Referenced by:
    TABLE "courses" CONSTRAINT "courses_faculty_id_fkey" FOREIGN KEY (faculty_id) REFERENCES faculty(faculty_id)

dbmsproject=# \d student_courses
           Table "public.student_courses"
  Column   |  Type  | Collation | Nullable | Default 
-----------+--------+-----------+----------+---------
 user_id   | bigint |           | not null | 
 course_id | bigint |           | not null | 
Indexes:
    "student_courses_pkey" PRIMARY KEY, btree (user_id, course_id)
Foreign-key constraints:
    "student_courses_course_id_fkey" FOREIGN KEY (course_id) REFERENCES courses(course_id) ON DELETE CASCADE
    "student_courses_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE

                    Table "public.students"
   Column    |         Type          | Collation | Nullable | Default 
-------------+-----------------------+-----------+----------+---------
 user_id     | bigint                |           | not null | 
 semester    | smallint              |           |          | 
 roll_number | character varying(50) |           | not null | 
 cgpa        | numeric(4,2)          |           |          | 
Indexes:
    "students_pkey" PRIMARY KEY, btree (user_id)
    "students_roll_number_key" UNIQUE CONSTRAINT, btree (roll_number)
Check constraints:
    "students_cgpa_check" CHECK (cgpa >= 0::numeric AND cgpa <= 10::numeric)
    "students_semester_check" CHECK (semester >= 1 AND semester <= 12)
Foreign-key constraints:
    "students_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE
Referenced by:
    TABLE "exam_results" CONSTRAINT "exam_results_student_id_fkey" FOREIGN KEY (student_id) REFERENCES students(user_id) ON DELETE CASCADE

                                  Table "public.users"
  Column  |          Type          | Collation | Nullable |             Default              
----------+------------------------+-----------+----------+----------------------------------
 user_id  | bigint                 |           | not null | generated by default as identity
 email    | character varying(255) |           | not null | 
 password | text                   |           | not null | 
 role     | character varying(20)  |           | not null | 
 dob      | date                   |           |          | 
 address  | text                   |           |          | 
Indexes:
    "users_pkey" PRIMARY KEY, btree (user_id)
    "users_email_key" UNIQUE CONSTRAINT, btree (email)
Referenced by:
    TABLE "faculty" CONSTRAINT "faculty_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE
    TABLE "student_courses" CONSTRAINT "student_courses_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE
    TABLE "students" CONSTRAINT "students_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE


Implement the rest of functionality with schema and main 